# 虚拟内存

**虚拟内存是操作系统为每个进程独立分配的一套用于访问计算机物理内存的虚拟地址**

单片机没有操作系统，在运行程序时，cpu直接操作内存的`物理地址`，所以单片机不能同时运行两个程序，因为第二个程序在一个内存地址上写入新值，会直接覆盖第一个程序在该内存地址上的值。

所以操作系统通过为每一个进程分配一个`虚拟内存`，来将进程所使用的物理内存地址分隔开。每个进程在自己的地盘里玩，互不干涉。

*操作系统会将不同进程的虚拟地址和不同内存的物理地址映射起来，虚拟地址如何落到物理地址对进程来说是透明的*

这样在运行多个程序的时候，就不会导致`物理地址`冲突了

* 进程所使用的内存地址叫做`虚拟内存地址`
* 实际存在硬件里的空间地址叫做`物理内存地址`

操作系统通过`内存分段`和`内存分页`来管理虚拟地址与物理地址之间的关系
# 内存分段

将一个程序分成若干个逻辑分段，比如：`代码分段`、`数据分段`、`栈段`、`堆段`。不同的段有着不同的属性。

分段机制的虚拟内存由`段选择因子`和`段内偏移量`组成
* `段选择因子`保存在`段寄存器`中，段选择因子中的`段号`被用作`段表`的索引
* `段表`是`虚拟地址`与`物理地址`的映射，段表保存了`段的基地址`、`段的界限`和`特权等级`
* `段内偏移量`位于`0`和`段界限`之间，通过`段基`和`段内偏移量`就能计算出物理内存地址
![[虚拟内存.svg]]
从上面的图片可以看出，`虚拟地址`通过`段表`与物理地址进行映射，根据当前段段`段基地址`加上`偏移量`就能找到物理内存中的地址
![[分段内存.svg]]